package com.ufgov.zc.server.cp.dao.ibatis;import java.sql.SQLException;import java.util.HashMap;import java.util.List;import java.util.Map;import org.springframework.orm.ibatis.SqlMapClientCallback;import org.springframework.orm.ibatis.support.SqlMapClientDaoSupport;import com.ibatis.sqlmap.client.SqlMapExecutor;import com.ufgov.zc.common.cp.model.CpPayTransferList;import com.ufgov.zc.common.cp.model.CpPayTransferRelation;import com.ufgov.zc.common.cp.model.CpPayTransferVou;import com.ufgov.zc.common.system.constants.NumLimConstants;import com.ufgov.zc.common.system.dto.ElementConditionDto;import com.ufgov.zc.server.cp.dao.ICpPayTransferVouDao;import com.ufgov.zc.server.system.util.NumLimUtil;import com.ufgov.zc.server.system.util.Util;public class CpPayTransferVouDao extends SqlMapClientDaoSupport implements ICpPayTransferVouDao {  public List getCpPayTransferVou(ElementConditionDto dto) {//    dto.setNumLimitStr(NumLimUtil.getInstance().getNumLimCondByCoType(dto.getNumLimCompoId(), NumLimConstants.FWATCH));    List list = this.getSqlMapClientTemplate().queryForList("CpPayTransferVou.getCpPayTransferVou", dto);    List vouListList = this.getSqlMapClientTemplate().queryForList("CpPayTransferVou.getCpPayTransferList", dto);    Map vouListMap = Util.createKeyListMap("payTransferVouId", vouListList);    List vouRelationList = this.getSqlMapClientTemplate().queryForList("CpPayTransferVou.getCpPayTransferRelation", dto);    Map vouRelationMap = Util.createKeyListMap("payTransferVouId", vouRelationList);    for (int i = 0; i < list.size(); i++) {      CpPayTransferVou v = (CpPayTransferVou) list.get(i);      List tempList1 = (List) vouListMap.get(v.getPayTransferVouId());      List tempList2 = (List) vouRelationMap.get(v.getPayTransferVouId());      if (tempList1 != null) {        v.setCpPayTransferLists(tempList1);      }      if (tempList2 != null) {        v.setCpPayTransferRelations(tempList2);      }    }    return list;  }  public int updateCpvoucherByPayTransferVouId(CpPayTransferVou bill) {    Map params = new HashMap();    params.put("payTransferVouId", bill.getPayTransferVouId());    String vouNoListStr = bill.getPayVouNoList();    String[] buffer = vouNoListStr.split(",");    String temp = "";    for (int i = 0; i < buffer.length; i++) {      temp += "," + "'" + buffer[i] + "'";    }    temp = temp.substring(1);    params.put("payVouNoList", temp);    return this.getSqlMapClientTemplate().update("CpPayTransferVou.updateCpvoucherByPayTransferVouId", params);  }  public int updateCpvoucherByPayTransferVouIdForDelete(CpPayTransferVou bill) {    Map params = new HashMap();    params.put("payTransferVouId", bill.getPayTransferVouId());    return this.getSqlMapClientTemplate().update("CpPayTransferVou.updateCpvoucherByPayTransferVouIdForDelete", params);  }  public void insertCpPayTransferVou(CpPayTransferVou bill) {    this.getSqlMapClientTemplate().insert("CpPayTransferVou.insertCpPayTransferVou", bill);  }  public void insertCpPayTransferList(CpPayTransferList balList) {    this.getSqlMapClientTemplate().insert("CpPayTransferVou.insertCpPayTransferList", balList);  }  public void insertCpPayTransferRelation(CpPayTransferRelation balRelation) {    this.getSqlMapClientTemplate().insert("CpPayTransferVou.insertCpPayTransferRelation", balRelation);  }  public void deleteCpPayTransferVou(CpPayTransferVou bill) {    this.getSqlMapClientTemplate().delete("CpPayTransferVou.deleteCpPayTransferVou", bill);  }  public void deleteCpPayTransferListByVouNo(CpPayTransferVou bill) {    this.getSqlMapClientTemplate().delete("CpPayTransferVou.deleteCpPayTransferListByVouNo", bill);  }  public void deleteCpPayRelationByVouNo(CpPayTransferVou bill) {    this.getSqlMapClientTemplate().delete("CpPayTransferVou.deleteCpPayRelationByVouNo", bill);  }  public void updateCpPayTransferVouStatus(Map params) {    this.getSqlMapClientTemplate().update("CpPayTransferVou.updateCpPayTransferVouAstatus", params);  }  public void updateCpPayTransferVouPrintTimes(String ids) {    this.getSqlMapClientTemplate().update("CpPayTransferVou.updateCpPayTransferVouPrintTimes", ids);  }  public void increaseExpTimes(final List idList) {    this.getSqlMapClientTemplate().execute(new SqlMapClientCallback() {      public Object doInSqlMapClient(SqlMapExecutor executor) throws SQLException {        executor.startBatch();        for (int i = 0; i < idList.size(); i++) {          executor.update("CpPayTransferVou.increaseExpTimes", idList.get(i));        }        executor.executeBatch();        return null;      }    });  }}