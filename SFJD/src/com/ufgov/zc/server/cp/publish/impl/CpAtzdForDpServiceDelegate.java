package com.ufgov.zc.server.cp.publish.impl;import java.util.ArrayList;import java.util.HashMap;import java.util.List;import java.util.Map;import com.ufgov.zc.common.cp.model.CpPlanAgentBill;import com.ufgov.zc.common.cp.publish.ICpAtzdForDpServiceDelegate;import com.ufgov.zc.common.dp.model.DpDetail;import com.ufgov.zc.common.system.RequestMeta;import com.ufgov.zc.common.system.dto.ElementConditionDto;import com.ufgov.zc.common.system.dto.PrintObject;import com.ufgov.zc.server.cp.service.ICpPlanAgentBIllForTzdlService;import com.ufgov.zc.server.cp.service.ICpPlanAgentBillService;import com.ufgov.zc.server.cp.service.ICpPlanAgentDBillService;import com.ufgov.zc.server.cp.service.ICpPlanAgentListService;import com.ufgov.zc.server.cp.service.ICpPlanAgentRelationService;import com.ufgov.zc.server.cp.service.ICpPlanClearBillService;import com.ufgov.zc.server.cp.service.ICpPlanClearListService;import com.ufgov.zc.server.cp.service.ICpPlanClearRelationService;import com.ufgov.zc.server.dp.service.IDpDetailService;import com.ufgov.zc.server.system.util.GkBusinessLogUtil;public class CpAtzdForDpServiceDelegate implements ICpAtzdForDpServiceDelegate {  private ICpPlanAgentBillService cpPlanAgentBillService;  private ICpPlanAgentDBillService cpPlanAgentDBillService;  private ICpPlanAgentListService cpPlanAgentListService;  private ICpPlanAgentRelationService cpPlanAgentRelationService;  private ICpPlanClearBillService cpPlanClearBillService;  private ICpPlanClearListService cpPlanClearListService;  private ICpPlanClearRelationService cpPlanClearRelationService;  private ICpPlanAgentBIllForTzdlService cpPlanAgentBIllForTzdlService;  private IDpDetailService dpDetailService;  public List getCpPlanAgentBill(RequestMeta requestMeta, ElementConditionDto elementDto) {    return cpPlanAgentBillService.getCpPlanAgentBill(elementDto);  }  public List getCpPlanAgentDBill(RequestMeta requestMeta, String planAgentBillId) {    return cpPlanAgentDBillService.getCpPlanAgentDBill(planAgentBillId);  }  public List getCpPlanAgentList(RequestMeta requestMeta, String planAgentBillId) {    return cpPlanAgentListService.getCpPlanAgentList(planAgentBillId);  }  public List getCpPlanAgentRelation(RequestMeta requestMeta, String planAgentBillId) {    return cpPlanAgentRelationService.getCpPlanAgentRelation(planAgentBillId);  }  public List getCpPlanClearBill(RequestMeta requestMeta, ElementConditionDto elementDto) {    return cpPlanClearBillService.getCpPlanClearBill(elementDto);  }  public List getCpPlanClearList(RequestMeta requestMeta, String planClearBillId) {    return cpPlanClearListService.getCpPlanClearList(planClearBillId);  }  public List getCpPlanClearList(RequestMeta requestMeta, String planClearBillId, String billType) {    return cpPlanClearListService.getCpPlanClearList(planClearBillId, billType);  }  public List getCpPlanClearRelation(RequestMeta requestMeta, String planClearBillId) {    return cpPlanClearRelationService.getCpPlanClearRelation(planClearBillId);  }  public ICpPlanAgentBillService getCpPlanAgentBillService() {    return cpPlanAgentBillService;  }  public void setCpPlanAgentBillService(ICpPlanAgentBillService cpPlanAgentBillService) {    this.cpPlanAgentBillService = cpPlanAgentBillService;  }  public ICpPlanAgentDBillService getCpPlanAgentDBillService() {    return cpPlanAgentDBillService;  }  public void setCpPlanAgentDBillService(ICpPlanAgentDBillService cpPlanAgentDBillService) {    this.cpPlanAgentDBillService = cpPlanAgentDBillService;  }  public ICpPlanAgentListService getCpPlanAgentListService() {    return cpPlanAgentListService;  }  public void setCpPlanAgentListService(ICpPlanAgentListService cpPlanAgentListService) {    this.cpPlanAgentListService = cpPlanAgentListService;  }  public ICpPlanAgentRelationService getCpPlanAgentRelationService() {    return cpPlanAgentRelationService;  }  public void setCpPlanAgentRelationService(ICpPlanAgentRelationService cpPlanAgentRelationService) {    this.cpPlanAgentRelationService = cpPlanAgentRelationService;  }  public ICpPlanClearBillService getCpPlanClearBillService() {    return cpPlanClearBillService;  }  public void setCpPlanClearBillService(ICpPlanClearBillService cpPlanClearBillService) {    this.cpPlanClearBillService = cpPlanClearBillService;  }  public ICpPlanClearListService getCpPlanClearListService() {    return cpPlanClearListService;  }  public void setCpPlanClearListService(ICpPlanClearListService cpPlanClearListService) {    this.cpPlanClearListService = cpPlanClearListService;  }  public ICpPlanClearRelationService getCpPlanClearRelationService() {    return cpPlanClearRelationService;  }  public void setCpPlanClearRelationService(ICpPlanClearRelationService cpPlanClearRelationService) {    this.cpPlanClearRelationService = cpPlanClearRelationService;  }  /**   * @return the cpPlanAgentBIllForTzdlService   */  public ICpPlanAgentBIllForTzdlService getCpPlanAgentBIllForTzdlService() {    return cpPlanAgentBIllForTzdlService;  }  /**   * @param cpPlanAgentBIllForTzdlService the cpPlanAgentBIllForTzdlService to set   */  public void setCpPlanAgentBIllForTzdlService(ICpPlanAgentBIllForTzdlService cpPlanAgentBIllForTzdlService) {    this.cpPlanAgentBIllForTzdlService = cpPlanAgentBIllForTzdlService;  }  public void setDpDetailService(IDpDetailService dpDetailService) {    this.dpDetailService = dpDetailService;  }  public IDpDetailService getDpDetailService() {    return dpDetailService;  }  public PrintObject genPlanAgentBillPrintObjectFN(List cpPlanAgentBillList, RequestMeta requestMeta) {    return this.cpPlanAgentBillService.genMainSubPrintObject(cpPlanAgentBillList);  }  public PrintObject genPlanAgentBillPrintObjectForDBillFN(List cpPlanAgentBillList, RequestMeta requestMeta) {    return this.cpPlanAgentBillService.genMainSubPrintObjectForDBill(cpPlanAgentBillList);  }  public PrintObject genPlanClearPrintObjectFN(List cpPlanClearBillList, RequestMeta requestMeta) {    return this.cpPlanClearBillService.genMainSubPrintObject(cpPlanClearBillList);  }  public PrintObject genSumPlanClearPrintObjectFN(List cpPlanClearBillList, RequestMeta requestMeta) {    return this.cpPlanClearBillService.genSumMainSubPrintObject(cpPlanClearBillList);  }  public PrintObject genSumPlanAgentBillPrintObjectFN(List cpPlanAgentBillList, RequestMeta requestMeta) {    return this.cpPlanAgentBillService.genSumMainSubPrintObject(cpPlanAgentBillList);  }  public PrintObject genSumPlanAgentBillPrintObjectForDBillFN(List cpPlanAgentBillList,  RequestMeta requestMeta) {    return this.cpPlanAgentBillService.genSumMainSubPrintObjectForDBill(cpPlanAgentBillList);  }  public void increasePlanClearBillPrintTimes(List planClearBillIdList, RequestMeta requestMeta) {    this.cpPlanClearBillService.increasePrintTimes(planClearBillIdList);  }  public void increasePlanAgentBillPrintTimes(List cpPlanAgentBillIdList, RequestMeta requestMeta) {    this.cpPlanAgentBillService.increasePrintTimes(cpPlanAgentBillIdList);  }  public void increasePlanAgentBillPrintTimesForDBill(List cpPlanAgentBillIdList, RequestMeta requestMeta) {    this.cpPlanAgentBillService.increasePrintTimesForDBill(cpPlanAgentBillIdList);  }  public List getCpPlanAgentBillForDBill(ElementConditionDto elementDto, RequestMeta requestMeta) {    return this.cpPlanAgentBillService.getCpPlanAgentBillForDBill(elementDto);  }  public String sendBankFN(String vouType, List cpPlanBillList, String transtype, String agentType,  RequestMeta requestMeta) {    if ("3".equals(vouType)) {      List dpDetailList = new ArrayList();      List dpist = new ArrayList();      for (int i = 0; i < cpPlanBillList.size(); i++) {        dpist = cpPlanClearBillService.getCpPlanClearRelationForVouNo((String) cpPlanBillList.get(i));        dpDetailList.addAll(dpist);      }      GkBusinessLogUtil.saveGkBusinessLog(dpDetailList);      return this.cpPlanAgentBillService.sendBankClearFN(cpPlanBillList, transtype, agentType);//3:授权支付汇总清算额度通知单    } else {      List sendBbList = new ArrayList();      List sendBaList = new ArrayList();      for (int i = 0; i < cpPlanBillList.size(); i++) {        Map map = (Map) cpPlanBillList.get(0);        sendBbList = (List) map.get("sendBb");        sendBaList = (List) map.get("sendBa");      }      String resultBb = sendBb(sendBbList, transtype, agentType);//发送到清算系统      String resultBa = sendBa(sendBaList, transtype, agentType);//银行接口      List dpDetailList = new ArrayList();      List dpist = new ArrayList();      for (int i = 0; i < cpPlanBillList.size(); i++) {        dpist = cpPlanAgentRelationService.getCpPlanAgentRelationForVouNo((String) cpPlanBillList.get(i));        dpDetailList.addAll(dpist);      }      GkBusinessLogUtil.saveGkBusinessLog(dpDetailList);      if (isNotNull(resultBb) || isNotNull(resultBa)) {        return resultBb + resultBa;      } else {        return null;      }    }  }  private boolean isNotNull(String str) {    return str != null && !"".equals(str);  }  //发送到清算系统（1:授权支付额度通知单发送 2:授权支付额度明细单）  private String sendBb(List sendBbList, String transtype, String agentType) {    StringBuffer str = new StringBuffer();    for (int i = 0; i < sendBbList.size(); i++) {      CpPlanAgentBill bill = (CpPlanAgentBill) sendBbList.get(i);      String result = this.cpPlanAgentBillService.sendBankBbFN(bill, transtype, agentType);      str.append(result == null ? "" : result);    }    return str.toString();  }  //银行接口（1:授权支付额度通知单发送 2:授权支付额度明细单）  private String sendBa(List sendBaList, String transtype, String agentType) {    StringBuffer str = new StringBuffer();    for (int i = 0; i < sendBaList.size(); i++) {      CpPlanAgentBill bill = (CpPlanAgentBill) sendBaList.get(i);      String result = this.cpPlanAgentBillService.sendBankBaFN(bill, transtype, agentType);      str.append(result == null ? "" : result);    }    return str.toString();  }  public List getCpPlanAgentBill1(ElementConditionDto elementDto, RequestMeta requestMeta) {    return this.cpPlanAgentBillService.getCpPlanAgentBill1(elementDto);  }  public void cancelCpPlanAgentBill(List cpPlanAgentBills, RequestMeta requestMeta) {    // TODO Auto-generated method stub    this.cpPlanAgentBIllForTzdlService.cancelCpPlanAgentBill(cpPlanAgentBills);  }  public void genCpPlanAgentBill(ElementConditionDto condition, List dpDetails, RequestMeta requestMeta) {    // TODO Auto-generated method stub    this.cpPlanAgentBIllForTzdlService.genCpPlanAgentBill(condition, dpDetails);    //不能一起生成，在撤销的时候有问题    // this.cpPlanClearBillService.genCpPlanClearBill(condition, dpDetails);  }  public PrintObject genCpPlanAgentBillPrintObject(List cpPayBalBillList, RequestMeta requestMeta) {    // TODO Auto-generated method stub    return cpPlanAgentBIllForTzdlService.genCpPlanAgentBillPrintObject(cpPayBalBillList);  }  public void updateCpPlanAgentBillPrintTimes(String ids, RequestMeta requestMeta) {    // TODO Auto-generated method stub    cpPlanAgentBIllForTzdlService.updateCpPlanAgentBillPrintTimes(ids);  }  public void updateCpPlanAgentBillStatus(List listId, String type, RequestMeta requestMeta) {    for (int i = 0; i < listId.size(); i++) {      Map params = new HashMap();      params.put("status", type);      params.put("ids", (String) listId.get(i));      cpPlanAgentBIllForTzdlService.updateCpPlanAgentBillStatus(params);    }  }  /*   * 生成通知单方式1：同时生成 2：只生成额度通知单 3：只生成汇总清算额度通知单   * billType  1:正常  2:注销   */  public void genACpPlanAgentBill(String isAutoMatchAccount, String createTzdType, String billType,  String dpDetailId, String userId, String procDate, List dpDetails, RequestMeta requestMeta) {    if ("Y".equalsIgnoreCase(isAutoMatchAccount)) {      if ("1".equals(createTzdType)) {        dpDetailService.sumAzdForDpDetail(createTzdType, billType, dpDetailId, userId, procDate, null);        GkBusinessLogUtil.saveGkBusinessLog(dpDetails);      } else if ("2".equals(createTzdType)) {        cpPlanAgentBIllForTzdlService.genACpPlanAgentBill(createTzdType, billType, dpDetailId, userId,        procDate, dpDetails);      } else if ("3".equals(createTzdType)) {        cpPlanClearBillService.genACpPlanClearBill(createTzdType, billType, dpDetailId, userId, procDate,        dpDetails);      }    } else {      dpDetailService.sumAzdForDpDetail(createTzdType, billType, dpDetailId, userId, procDate, null);      GkBusinessLogUtil.saveGkBusinessLog(dpDetails);    }  }  public void genDCpPlanClearBill(List dpDetails, RequestMeta requestMeta) {    cpPlanClearBillService.genDCpPlanClearBill(dpDetails);  }  public void cancelDCpPlanClearBill(List cpPlanClearBills, RequestMeta requestMeta) {    cpPlanClearBillService.cancelCpPlanClearBill(cpPlanClearBills);  }}