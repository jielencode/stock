package com.ufgov.zc.server.system.dao.ibatis;import java.util.HashMap;import java.util.List;import java.util.Map;import org.springframework.orm.ibatis.support.SqlMapClientDaoSupport;import com.ufgov.zc.common.system.RequestMeta;import com.ufgov.zc.server.system.dao.IAsValDao;public class AsValDao extends SqlMapClientDaoSupport implements IAsValDao {  public List getAsVal(String valSetId) {    List rtn=this.getSqlMapClientTemplate().queryForList("AsVal.getAsVal", valSetId);    if(rtn==null || rtn.size()==0){      Map sqls=(Map) getSqlMapClientTemplate().queryForObject("AsVal.getAsValSql", valSetId);      if(sqls==null)return null;      String sql=(String) sqls.get("VAL_SQL");      if(sql==null)return null;            rtn=getSqlMapClientTemplate().queryForList("AsVal.getAsValBySql", sql);    }    return rtn;  }  public Map getAsValMap(String valSetId) {    return this.getSqlMapClientTemplate().queryForMap("AsVal.getAsValMap", valSetId, "valId", "val");  }  public List getCompanyLevel(String sqlId) {    Map map = new HashMap();    map.put("sqlId", sqlId);    return this.getSqlMapClientTemplate().queryForList("AsVal.getCompanyLevel", map);  }     public List getAsVal(String valSetId, RequestMeta meta) {    List rtn=this.getSqlMapClientTemplate().queryForList("AsVal.getAsVal", valSetId);    if(rtn==null || rtn.size()==0){      Map sqls=(Map) getSqlMapClientTemplate().queryForObject("AsVal.getAsValSql", valSetId);      if(sqls==null)return null;      String sql=(String) sqls.get("VAL_SQL");      if(sql==null)return null;       sql=replaceVal(sql, meta);      rtn=getSqlMapClientTemplate().queryForList("AsVal.getAsValBySql", sql);    }    return rtn;  }  /**   * 目前支持'@@svNd'、'@@svCoCode'、'@@svUserID'三个变量   * @param str   * @param meta   * @return   */  String replaceVal(String str,RequestMeta meta){    if(str==null)return str;    int n=str.indexOf("@@");      if(n<0)return str;        String s1=str.substring(0, n);    String valNd=str.substring(n, n+6);    String valCoCode=str.substring(n, n+10);    String valUserId=str.substring(n, n+10);    if("@@svNd".equalsIgnoreCase(valNd)){      String t=s1+meta.getSvNd()+str.substring(n+6);      return replaceVal(t,meta);    }else if("@@svCoCode".equalsIgnoreCase(valCoCode)){      String t=s1+meta.getSvCoCode()+str.substring(n+10);      return replaceVal(t,meta);       }else if("@@svUserID".equalsIgnoreCase(valUserId)){      String t=s1+meta.getSvUserID()+str.substring(n+10);      return replaceVal(t,meta);    }        return str;  }}