package com.ufgov.zc.client.console;import java.awt.BorderLayout;import java.awt.Dimension;import java.awt.FlowLayout;import java.awt.Window;import java.awt.event.KeyAdapter;import java.awt.event.KeyEvent;import java.awt.event.WindowAdapter;import java.awt.event.WindowEvent;import java.util.HashMap;import java.util.List;import java.util.Map;import javax.swing.JFrame;import javax.swing.JLabel;import javax.swing.JPanel;import javax.swing.JScrollPane;import javax.swing.JTextField;import javax.swing.JTree;import javax.swing.tree.DefaultMutableTreeNode;import javax.swing.tree.DefaultTreeSelectionModel;import javax.swing.tree.TreePath;import javax.swing.tree.TreeSelectionModel;import com.ufgov.zc.client.common.ParentWindowAware;import com.ufgov.zc.common.console.model.AsOrg;public class AsOrgTreePanel extends JPanel implements ParentWindowAware {  private static final long serialVersionUID = 1L;  private JPanel treePanel = new JPanel();  private AsOrgTree selectTree;  private Window parentWindow;  protected JPanel searchBar = new JPanel() {    private static final long serialVersionUID = 1L;    {      //      this.setFloatable(false);      this.setLayout(new FlowLayout(FlowLayout.LEFT));    }  };  protected JTextField searchField = new JTextField(20);  protected Map<Object, DefaultMutableTreeNode> treeNodeMap = new HashMap<Object, DefaultMutableTreeNode>();  //  public AsOrgTreePanel() {  //    this(null);  //  }  public AsOrgTreePanel() {    selectTree = new AsOrgTree(true, "");    init();  }  private void init() {    initSearchBar();    initTreePanel();    this.setLayout(new BorderLayout());    this.add(this.searchBar, BorderLayout.NORTH);    this.add(this.treePanel, BorderLayout.CENTER);    //    treeNodeMap=this.selectTree.getTreeNodeMap();  }  private void initSearchBar() {    searchBar.add(searchField);    searchField.addKeyListener(new KeyAdapter() {      public void keyPressed(KeyEvent e) {        if (e.getKeyCode() == KeyEvent.VK_ENTER) {          doSearch();        }      }    });  }  private void initTreePanel() {    DefaultTreeSelectionModel selectionModel = new DefaultTreeSelectionModel();    selectionModel.setSelectionMode(TreeSelectionModel.SINGLE_TREE_SELECTION);    selectTree.setSelectionModel(selectionModel);    selectTree.expandRow(1);    //    selectTree.expandAll(true);    this.treePanel.setLayout(new BorderLayout());    JScrollPane scrollPane = new JScrollPane(selectTree);    scrollPane.getVerticalScrollBar().setPreferredSize(new Dimension(12, 0));    this.treePanel.add(scrollPane, BorderLayout.CENTER);  }  protected void doSearch() {    int rowCount = selectTree.getRowCount();    DefaultMutableTreeNode node = (DefaultMutableTreeNode) selectTree.getLastSelectedPathComponent();    if (node == null || node.getNextNode() == null)      node = (DefaultMutableTreeNode) selectTree.getModel().getRoot();    DefaultMutableTreeNode currentNode = node;    node = node.getNextNode();    if (node == null)      return;    // 从当前选中节点开始循环遍历整个树    while (node != currentNode) {      AsOrg asOrg = (AsOrg) node.getUserObject();      String codeName = asOrg.getCode() + asOrg.getName();      if (codeName.indexOf(searchField.getText()) >= 0) {        for (int i = rowCount - 1; i > 0; i--) {          selectTree.collapseRow(i);        }        selectTree.setSelectionPath(new TreePath(node.getPath()));        ///        int[] selectedRows = selectTree.getSelectionRows();        if (selectedRows.length > 0) {          selectTree.scrollRowToVisible(selectedRows[0]);        }        return;      }      node = node.getNextNode();      // 遍历完毕没找到，从根目录开始循环找      if (node == null)        node = (DefaultMutableTreeNode) selectTree.getModel().getRoot();    }  }  public JTree getSelectTree() {    return selectTree;  }  public Map getMap() {    return selectTree.getAsOrgMap();  }  public List getList() {    return selectTree.getAsOrgList();  }  public void refreshTree() {    selectTree.refreshAsOrgList();    selectTree.createTree();  }  public static void main(String[] args) {    AsOrgTreePanel treepanle = new AsOrgTreePanel();    JFrame f = new JFrame();    f.getContentPane().add(treepanle);    f.setSize(400, 300);    f.setLocationRelativeTo(null);    f.setVisible(true);    f.addWindowListener(new WindowAdapter() {      public void windowClosing(WindowEvent e) {        System.exit(0);      }    });  }  public Window getParentWindow() {    return parentWindow;  }  public void setParentWindow(Window parentWindow) {    this.parentWindow = parentWindow;  }}