package com.ufgov.zc.client.component;import java.awt.BorderLayout;import java.awt.Dimension;import java.awt.FlowLayout;import java.awt.event.ActionEvent;import java.awt.event.ActionListener;import java.awt.event.KeyAdapter;import java.awt.event.KeyEvent;import java.util.List;import java.util.Vector;import javax.swing.JLabel;import javax.swing.JMenuItem;import javax.swing.JPanel;import javax.swing.JPopupMenu;import javax.swing.JScrollPane;import javax.swing.JTable;import javax.swing.JTextField;import javax.swing.table.DefaultTableModel;import javax.swing.table.TableRowSorter;import com.ufgov.smartclient.component.table.fixedtable.JPageableFixedTable;import com.ufgov.zc.client.common.LangTransMeta;import com.ufgov.zc.client.common.ServiceFactory;import com.ufgov.zc.client.common.WorkEnv;import com.ufgov.zc.client.util.SwingUtil;import com.ufgov.zc.common.dp.model.DpDetail;import com.ufgov.zc.common.dp.publish.IDpDetailServiceDelegate;import com.ufgov.zc.common.system.RequestMeta;public class QueryDpDetailMenu extends JPopupMenu {  private IDpDetailServiceDelegate dpDetailServiceDelegate;  private QueryDpDetailMenu self = this;  private static final long serialVersionUID = 1L;  private JMenuItem queryDpInfoMnItm = new JMenuItem("查看额度明细信息");  private String balanceId;  private List resultList;  public QueryDpDetailMenu(final String balanceId) {    this.add(queryDpInfoMnItm);    this.balanceId = balanceId;    initService();    initResult(balanceId);    queryDpInfoMnItm.addActionListener(new ActionListener() {      public void actionPerformed(ActionEvent e) {        QueryDpDetailInfoDialog dlg = new QueryDpDetailInfoDialog(balanceId);        dlg.setVisible(true);      }    });  }  public void initService() {    this.dpDetailServiceDelegate = (IDpDetailServiceDelegate) ServiceFactory.create(    IDpDetailServiceDelegate.class, "dpDetailServiceDelegate");    LangTransMeta.init("DP%");  }  public void initResult(String balanceId) {    RequestMeta requestMeta = WorkEnv.getInstance().getRequestMeta();    resultList = dpDetailServiceDelegate.getDpDetailInfo(balanceId, 2009, requestMeta);  }  private class QueryDpDetailInfoDialog extends GkBaseDialog {    JLabel queryLbl = new JLabel("查找：");    JTextField queryTxt = new JTextField();    JPageableFixedTable resultTable = SwingUtil.createTable(JPageableFixedTable.class);    private TableRowSorter resultSorter = new TableRowSorter();    public QueryDpDetailInfoDialog(String balanceId) {      this.setTitle("额度名细信息");      this.setSize(700, 500);      this.moveToScreenCenter();      this.setModal(false);      JPanel parentPanel = new JPanel(new BorderLayout());      JPanel queryPanel = new JPanel(new FlowLayout(FlowLayout.LEFT));      queryPanel.add(queryLbl);      queryPanel.add(queryTxt);      queryTxt.addKeyListener(new KeyAdapter() {        public void keyReleased(KeyEvent e) {          resultSorter.setRowFilter(new SimpleRowFilter(queryTxt.getText()));          resultTable.repaint();        }      });      queryTxt.setColumns(20);      parentPanel.add(queryPanel, BorderLayout.NORTH);      JScrollPane pane = new JScrollPane();      DefaultTableModel model = initResultTableMode();      resultTable.setModel(model);      resultSorter.setModel(model);      resultTable.setRowSorter(resultSorter);      resultTable.setAutoResizeMode(JTable.AUTO_RESIZE_OFF);      resultTable.setPreferredScrollableViewportSize(new Dimension(700, 150));      pane.getViewport().add(resultTable);      parentPanel.add(pane, BorderLayout.CENTER);      this.add(parentPanel);    }    private DefaultTableModel initResultTableMode() {      DefaultTableModel tableModel = null;      Vector names = new Vector();      names.add(LangTransMeta.translate("DP_FIELD_DP_DETAIL_ID"));      names.add(LangTransMeta.translate("DP_FIELD_REMARK"));      names.add(LangTransMeta.translate("DP_FIELD_ORG_MONEY"));      names.add(LangTransMeta.translate("DP_FIELD_CUR_MONEY"));      names.add(LangTransMeta.translate("DP_FIELD_PM_ADJUST_CODE"));      names.add(LangTransMeta.translate("DP_FIELD_PROC_DATE"));      names.add(LangTransMeta.translate("DP_FIELD_EFFECT_DATE"));      names.add(LangTransMeta.translate("DP_FIELD_ORG_NAME"));      names.add(LangTransMeta.translate("DP_FIELD_CO_NAME"));      names.add(LangTransMeta.translate("DP_FIELD_ORIGIN_NAME"));      names.add(LangTransMeta.translate("DP_FIELD_B_ACC_NAME"));      names.add(LangTransMeta.translate("DP_FIELD_MANAGE_NAME"));      names.add(LangTransMeta.translate("DP_FIELD_PROJECT_NAME"));      names.add(LangTransMeta.translate("DP_FIELD_FUND_NAME"));      names.add(LangTransMeta.translate("DP_FIELD_PAYOUT_NAME"));      Vector values = new Vector();      for (int i = 0; i < resultList.size(); i++) {        DpDetail dpDetail = (DpDetail) resultList.get(i);        Vector rowData = new Vector();        rowData.add(dpDetail.getDpDetailId());        rowData.add(dpDetail.getRemark());        rowData.add(dpDetail.getOrgMoney());        rowData.add(dpDetail.getCurMoney());        rowData.add(dpDetail.getPmAdjustCode());        rowData.add(dpDetail.getProcdate());        rowData.add(dpDetail.getEffectDate());        rowData.add(dpDetail.getOrgName());        rowData.add(dpDetail.getCoName());        rowData.add(dpDetail.getOriginName());        rowData.add(dpDetail.getBaccCode());        rowData.add(dpDetail.getManageName());        rowData.add(dpDetail.getProjectName());        rowData.add(dpDetail.getFundName());        rowData.add(dpDetail.getPayoutName());        values.add(rowData);      }      tableModel = new DefaultTableModel(values, names) {        public boolean isCellEditable(int row, int colum) {          return false;        }      };      return tableModel;    }  }}