package com.ufgov.zc.client.component.element;import java.awt.BorderLayout;import java.awt.event.ItemEvent;import java.awt.event.ItemListener;import java.awt.event.WindowAdapter;import java.awt.event.WindowEvent;import java.util.HashMap;import java.util.List;import java.util.Map;import javax.swing.JFrame;import javax.swing.JPanel;import com.ufgov.zc.client.common.BillElementMeta;import com.ufgov.zc.client.common.ServiceFactory;import com.ufgov.zc.client.common.WorkEnv;import com.ufgov.zc.client.datacache.OrgDataCache;import com.ufgov.zc.common.commonbiz.model.Org;import com.ufgov.zc.common.commonbiz.publish.IBaseDataServiceDelegate;import com.ufgov.zc.common.system.RequestMeta;public class OrgComboBox extends EditCtrlComboBox {  private static final long serialVersionUID = 1L;  private Map<String, Org> dataMap = new HashMap<String, Org>();  private boolean firstAddNull = true;  public OrgComboBox() {    super();    init(null);    initDataBufferList();    initComboBox();  }  public OrgComboBox(String compoId) {    super();    init(compoId);    initDataBufferList();    initComboBox();  }  public OrgComboBox(boolean firstAddNull) {    super();    this.firstAddNull = firstAddNull;    init(null);    initDataBufferList();    initComboBox();  }  public OrgComboBox(boolean firstAddNull, String compoId) {    super();    this.firstAddNull = firstAddNull;    init(compoId);    initDataBufferList();    initComboBox();  }  private void init(String compoId) {    this.compoId = compoId;    this.elementCode = "ORG_CODE";    this.setPrototypeDisplayValue("AAAAAAAAAAAAAAA");    this.addItemListener(new ItemListener() {      public void itemStateChanged(ItemEvent e) {        if (((Org) getSelectedItem()) != null) {          Org data = (Org) getSelectedItem();          setToolTipText("[" + data.getCode() + "]" + data.getName());        } else {          setToolTipText(null);        }      }    });  }  private void initDataBufferList() {    int nd = WorkEnv.getInstance().getTransNd();    IBaseDataServiceDelegate baseDataServiceDelegate = (IBaseDataServiceDelegate) ServiceFactory.create(    IBaseDataServiceDelegate.class, "baseDataServiceDelegate");    RequestMeta requestMeta = WorkEnv.getInstance().getRequestMeta();    dataBufferList = OrgDataCache.getOrg();//取的的是所有的财政处室    //    if (requestMeta.getSvRoleId().equals(AsOptionMeta.getOptVal(ZcElementConstants.OPT_ZC_YSDWCG_ROLE))) {    //      numLimDataList = baseDataServiceDelegate.getZcOrg(nd, requestMeta);//取得的是所有的处室。    //    } else {    //      numLimDataList = dataBufferList;    //    }    numLimDataList = dataBufferList;    for (int i = 0; i < dataBufferList.size(); i++) {      Org data = (Org) dataBufferList.get(i);      this.dataMap.put(data.getCode(), data);    }  }  public void initComboBox() {    List dataList = BaseElementDataFilter.doFilter(dataBufferList, randomEdit, prefix, levelCtrl,    ctrlLevelNum);    dataList = BaseElementDataFilter.doNumLimFilter(dataList, numLimDataList);    this.removeAllItems();    if (firstAddNull) {      this.addItem(null);    }    for (int i = 0; i < dataList.size(); i++) {      Org data = (Org) dataList.get(i);      this.addItem(data);      this.addItemDisplaLable(data, "[" + data.getCode() + "]" + data.getName());    }  }  public Org getSelectedOrg() {    return (Org) this.getSelectedItem();  }  public void setSelectedOrg(Org org) {    this.setSelectedItem(org);  }  public void setSelectedOrgByCode(String orgCode) {    Org org = dataMap.get(orgCode);    this.setSelectedItem(org);  }  public void setBillElementMeta(BillElementMeta bem) {    if (elementCode != null && !elementCode.trim().equals("")) {      setRandomEdit(bem.isElementRandomEdit(elementCode));      setCtrlLevelNum(bem.getCtrlLevelNum(elementCode));      setEnabled(bem.isElementEditable(elementCode));      setEditable(bem.isElementEditable(elementCode));    }  }  public static void main(String[] args) {    JFrame f = new JFrame();    OrgComboBox textField = new OrgComboBox();    textField.setEditable(false);    textField.setEnabled(false);    textField.setEnabled(false);    //    textField.setCtrlLevelNum(3);    //    textField.setRandomEdit(false);    //    textField.setPrefix("01");    textField.initComboBox();    textField.setSelectedOrgByCode("4");    JPanel panel = new JPanel();    panel.add(textField);    f.getContentPane().add(panel, BorderLayout.NORTH);    // f.pack();    // SwingUtilities.updateComponentTreeUI(panel);    f.setSize(400, 300);    f.setLocationRelativeTo(null);    f.setVisible(true);    f.addWindowListener(new WindowAdapter() {      public void windowClosing(WindowEvent e) {        System.exit(0);      }    });  }}