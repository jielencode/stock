package com.ufgov.zc.client.component.element;import java.awt.Dialog;import java.awt.event.MouseAdapter;import java.awt.event.MouseEvent;import java.util.List;import javax.swing.JTable;import javax.swing.table.DefaultTableModel;import com.ufgov.zc.client.common.LangTransMeta;import com.ufgov.zc.client.common.ServiceFactory;import com.ufgov.zc.client.common.WorkEnv;import com.ufgov.zc.client.component.JButtonTextField;import com.ufgov.zc.client.component.JTableSelectDialog;import com.ufgov.zc.client.datacache.DAttrDataCache;import com.ufgov.zc.client.util.GkPreferencesStore;import com.ufgov.zc.client.util.NumLimUtil;import com.ufgov.zc.common.commonbiz.model.DAttr;import com.ufgov.zc.common.commonbiz.publish.IBaseDataServiceDelegate;import com.ufgov.zc.common.system.RequestMeta;import com.ufgov.zc.common.system.constants.NumLimConstants;import com.ufgov.zc.common.system.dto.ElementConditionDto;public class DAttrTableSelectDialog extends JTableSelectDialog {  protected String elementCode;  public DAttrTableSelectDialog(Dialog dialog, boolean modal, JButtonTextField triggerField, String dAttrType) {    super(dialog, modal, triggerField);  }  /**   *    */  private static final long serialVersionUID = -4407933154954926841L;  public void initTitle() {    DAttrTableSelectField dAttrField = (DAttrTableSelectField) triggerField;    LangTransMeta.init("GK%");    this.setTitle(LangTransMeta.translate("GK_TITLE_D_ATTR" + dAttrField.getDattrType()));  }  protected void initDataBufferList() {    DAttrTableSelectField dAttrField = (DAttrTableSelectField) triggerField;    int nd = WorkEnv.getInstance().getTransNd();    IBaseDataServiceDelegate baseDataServiceDelegate = (IBaseDataServiceDelegate) ServiceFactory.create(    IBaseDataServiceDelegate.class, "baseDataServiceDelegate");    RequestMeta requestMeta = WorkEnv.getInstance().getRequestMeta();    ElementConditionDto dto = new ElementConditionDto();    dto.setNd(nd);    dto.setDattrType(dAttrField.getDattrType());    dataBufferList = DAttrDataCache.getDAttr(dAttrField.getDattrType());    this.elementCode = (String) DAttr.dAttrMap.get(dAttrField.getDattrType());    dto.setNumLimitStr(NumLimUtil.getInstance().getNumLimCondByCoType(triggerField.compoId,    NumLimConstants.FWATCH, this.elementCode));    if (dto.getNumLimitStr() == null) {      numLimDataList = dataBufferList;    } else {      numLimDataList = baseDataServiceDelegate.getDAttr(dto, requestMeta);    }    for (int i = 0; i < dataBufferList.size(); i++) {      DAttr rowData = (DAttr) dataBufferList.get(i);      this.triggerField.dataMap.put(rowData.getCode(), rowData);    }    this.triggerField.filteredDataList = dataBufferList;  }  private List genTableData() {    List dataList = BaseElementDataFilter.doFilter(dataBufferList, this.triggerField.isRandomEdit(),    this.triggerField.getPrefix(), this.triggerField.isLevelCtrl(), this.triggerField.getCtrlLevelNum());    dataList = BaseElementDataFilter.doNumLimFilter(dataList, numLimDataList);    return dataList;  }  public void initSelectTable() {    DAttrTableSelectField dAttrField = (DAttrTableSelectField) triggerField;    String[] names = { LangTransMeta.translate("GK_FIELD_ND"),    LangTransMeta.translate("GK_FIELD_D_ATTR" + dAttrField.getDattrType() + "_CODE"),    LangTransMeta.translate("GK_FIELD_D_ATTR" + dAttrField.getDattrType() + "_NAME") };    Object[][] data = null;    this.triggerField.filteredDataList = this.genTableData();    tableDataList = this.genTableData();    data = new Object[tableDataList.size()][names.length];    for (int i = 0; i < tableDataList.size(); i++) {      DAttr rowData = (DAttr) tableDataList.get(i);      int col = 0;      data[i][col++] = rowData.getNd();      data[i][col++] = rowData.getCode();      data[i][col++] = rowData.getName();    }    DefaultTableModel model = new DefaultTableModel(data, names) {      public boolean isCellEditable(int row, int colum) {        return false;      }    };    selectTable.setPreferencesKey(this.getClass().getName() + "_selectTable");    selectTable.setPreferenceStore(GkPreferencesStore.preferenceStore());    selectTable.setModel(model);    selectTable.addMouseListener(new MouseAdapter() {      public void mouseClicked(MouseEvent e) {        if (e.getClickCount() == 2) {          doOK();        }      }    });    selectTable.setAutoResizeMode(JTable.AUTO_RESIZE_OFF);  }}