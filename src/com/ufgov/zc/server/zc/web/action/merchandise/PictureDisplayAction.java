package com.ufgov.zc.server.zc.web.action.merchandise;import java.awt.image.BufferedImage;import java.io.BufferedInputStream;import java.io.ByteArrayInputStream;import java.io.IOException;import java.io.InputStream;import javax.imageio.ImageIO;import javax.servlet.ServletOutputStream;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import org.apache.commons.logging.Log;import org.apache.commons.logging.LogFactory;import org.apache.struts.action.ActionForm;import org.apache.struts.action.ActionForward;import org.apache.struts.action.ActionMapping;import com.sun.image.codec.jpeg.JPEGCodec;import com.sun.image.codec.jpeg.JPEGImageEncoder;import com.ufgov.zc.common.system.model.AsFile;import com.ufgov.zc.server.zc.service.IZcEbSupplierService;import com.ufgov.zc.server.zc.web.action.StrutsAction;public class PictureDisplayAction extends StrutsAction {  private final static Log log = LogFactory.getLog(PictureDisplayAction.class);  public ActionForward execute(ActionMapping mapping, ActionForm form, HttpServletRequest request,  HttpServletResponse response) throws Exception {    BufferedInputStream inputimage = null;    BufferedImage image = null;    String fileID = request.getParameter("fileID");    try {      IZcEbSupplierService zcEbSupplierService = (IZcEbSupplierService) this.getWebApplicationContext().getBean("zcEbSupplierService");      AsFile asFile = zcEbSupplierService.getPictureAsFileById(fileID);      if (asFile != null) {        InputStream is = new ByteArrayInputStream(asFile.getFileContent());//将byte[]转化成InputStream        inputimage = new BufferedInputStream(is);        image = ImageIO.read(inputimage);        ServletOutputStream sos = response.getOutputStream();        JPEGImageEncoder encoder = JPEGCodec.createJPEGEncoder(sos);        encoder.encode(image);        inputimage.close();      } else {        return null;      }    } catch (Exception e) {      log.error(e);      throw e;    }    return null;  }}