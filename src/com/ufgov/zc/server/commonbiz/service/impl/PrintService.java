package com.ufgov.zc.server.commonbiz.service.impl;import java.util.ArrayList;import java.util.HashMap;import java.util.Iterator;import java.util.List;import java.util.Map;import org.josql.Query;import org.josql.QueryResults;import com.ufgov.zc.common.commonbiz.model.BaseBill;import com.ufgov.zc.common.dp.dto.DpTempBiReport;import com.ufgov.zc.common.system.dto.MainSubBill;import com.ufgov.zc.common.system.dto.PrintObject;import com.ufgov.zc.common.system.josql.JoSqlFunctions;import com.ufgov.zc.common.system.model.PrintSetting;import com.ufgov.zc.common.system.util.ObjectUtil;import com.ufgov.zc.server.commonbiz.service.IPrintService;import com.ufgov.zc.server.system.dao.IPrintDao;import com.ufgov.zc.server.system.print.PrintManager;public class PrintService implements IPrintService {  private IPrintDao printDao;  public IPrintDao getPrintDao() {    return printDao;  }  public void setPrintDao(IPrintDao printDao) {    this.printDao = printDao;  }  public PrintSetting getCurrentPrintSetting() {    return printDao.getCurrentPrintSetting();  }  public List getCurrentPrintTemplate() {    return printDao.getCurrentPrintTemplate();  }  public void savePrintSetting(PrintSetting printSetting) {    printDao.savePrintSetting(printSetting);  }  public PrintObject genMainBillPrintObject(BaseBill bill) {    return PrintManager.genMainBillPrintObject(bill);  }  public PrintObject genMainBillPrintObject(List billList) {    return PrintManager.genMainBillPrintObject(billList);  }  public PrintObject genMainBillPrintObject(BaseBill bill,  String templateCode) {    return PrintManager.genMainBillPrintObject(bill, templateCode);  }  public PrintObject genMainBillPrintObject(List billList,  String templateCode) {    return PrintManager.genMainBillPrintObject(billList, templateCode);  }  public PrintObject genMainSubPrintObject(List billList) {    List mainSubBillList = new ArrayList();    String josql = "select * from " + DpTempBiReport.class.getName() + " GROUP BY orgCode, fundCode";    Query query = new Query();    query.addFunctionHandler(new JoSqlFunctions());    QueryResults rs = null;    try {      query.parse(josql);      rs = query.execute(billList);    } catch (Exception e) {      throw new RuntimeException(e);    }    Map groupResultMap = rs.getGroupByResults();    Iterator it = ((HashMap) groupResultMap).keySet().iterator();    while (it.hasNext()) {      List key = (List) it.next();      List list = (List) groupResultMap.get(key);      Map sumMap = rs.getGroupBySaveValues(key);      DpTempBiReport mainBill = (DpTempBiReport) ObjectUtil.deepCopy(list.get(0));      MainSubBill msb = new MainSubBill();      msb.setMainBill(mainBill);      msb.setSubBillList(list);      mainSubBillList.add(msb);    }    return PrintManager.genMainSubPrintObject(mainSubBillList);  }}