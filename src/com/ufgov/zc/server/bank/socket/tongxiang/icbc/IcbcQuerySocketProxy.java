package com.ufgov.zc.server.bank.socket.tongxiang.icbc;import java.util.Date;import java.util.HashMap;import java.util.Map;import com.ufgov.zc.common.am.model.AmVoucher;import com.ufgov.zc.common.commonbiz.model.BaseBill;import com.ufgov.zc.common.cp.model.CpVoucher;import com.ufgov.zc.common.system.constants.SocketConstants;import com.ufgov.zc.common.system.model.ResultInfo;import com.ufgov.zc.common.system.util.DateUtil;public class IcbcQuerySocketProxy extends AbstractIcbcSocketProxy {  public IcbcQuerySocketProxy() {    super();  }  public IcbcQuerySocketProxy(Map prop) {    super(prop);  }  /**   * ?是否还需要将认证信息传送过去   */  public void beforeDealBusinessObject(Object businessObject) throws Exception {  }  public void afterDealBusinessObject(Object businessObject, ResultInfo resultInfo) throws Exception {    //对业务数据进行处理    System.out.println("it is after icbc query");    BaseBill voucher = (BaseBill) businessObject;    Map params = new HashMap();    if (SocketConstants.SUCCESS.equals(resultInfo.getResultCode())) {      if ("1".equals(resultInfo.getTradeFlag())) {        params.put("dealState", "3");        this.updateVoucherGroupState(params, voucher);      } else {        params.put("dealState", "0");        this.updateVoucherGroupState(params, voucher);      }    }  }  public String parseToXml(Object v) throws Exception {    // TODO Auto-generated method stub    BaseBill voucher = (BaseBill) v;    StringBuffer buffer = new StringBuffer();    buffer.append("<?xml version=\"1.0\" encoding=\"GB2312\" standalone=\"yes\"?>");    buffer.append("<MESSAGE>");    buffer.append("<TRXCODE>CZGH9400</TRXCODE>");    buffer.append("<TRXDATE>" + DateUtil.dateToDdString(new Date()) + "</TRXDATE>");    String vouNo = "";    if (voucher instanceof CpVoucher) {      vouNo = ((CpVoucher) voucher).getCpVouNo();    } else if (voucher instanceof AmVoucher) {      vouNo = ((AmVoucher) voucher).getVouNo();    }    buffer.append("<VOUNO>" + vouNo + "</VOUNO>");    buffer.append("</MESSAGE>");    return buffer.toString();  }}