package com.ufgov.zc.client.component;import java.awt.BorderLayout;import java.awt.Dimension;import java.awt.FlowLayout;import java.awt.event.KeyAdapter;import java.awt.event.KeyEvent;import java.awt.event.WindowAdapter;import java.awt.event.WindowEvent;import java.util.HashMap;import java.util.Map;import javax.swing.JFrame;import javax.swing.JLabel;import javax.swing.JPanel;import javax.swing.JScrollPane;import javax.swing.JTextField;import javax.swing.JTree;import javax.swing.tree.DefaultMutableTreeNode;import javax.swing.tree.DefaultTreeSelectionModel;import javax.swing.tree.TreePath;import javax.swing.tree.TreeSelectionModel;import com.ufgov.zc.client.util.Util;import com.ufgov.zc.common.commonbiz.model.Company;public class CompanyTreePanel extends JPanel {  private static final long serialVersionUID = 1L;  private JPanel treePanel = new JPanel();  private CompanyTree selectTree;  protected JPanel searchBar = new JPanel() {    private static final long serialVersionUID = 1L;    {      //      this.setFloatable(false);      this.setLayout(new FlowLayout(FlowLayout.LEFT));    }  };  private JLabel searchLabel = new JLabel("查找:");  protected JTextField searchField = new JTextField(25);  protected Map<Object, DefaultMutableTreeNode> treeNodeMap = new HashMap<Object, DefaultMutableTreeNode>();  public CompanyTreePanel() {    this(null);  }  public CompanyTreePanel(String compoId) {    selectTree = new CompanyTree(true, compoId);    init();  }  public CompanyTreePanel(String compoId, String dataRuleId) {    selectTree = new CompanyTree(true, compoId, dataRuleId);    init();  }  private void init() {    initSearchBar();    initTreePanel();    this.setLayout(new BorderLayout());    this.add(this.searchBar, BorderLayout.NORTH);    this.add(this.treePanel, BorderLayout.CENTER);    treeNodeMap = this.selectTree.getTreeNodeMap();    if (Util.isCurrCoTypeJc()) {      this.setVisible(false);    }  }  private void initSearchBar() {    searchBar.add(searchField);    searchField.addKeyListener(new KeyAdapter() {      public void keyPressed(KeyEvent e) {        if (e.getKeyCode() == KeyEvent.VK_ENTER) {          doSearch();        }      }    });  }  private void initTreePanel() {    DefaultTreeSelectionModel selectionModel = new DefaultTreeSelectionModel();    selectionModel.setSelectionMode(TreeSelectionModel.SINGLE_TREE_SELECTION);    selectTree.setSelectionModel(selectionModel);    selectTree.expandRow(1);    this.treePanel.setLayout(new BorderLayout());    JScrollPane scrollPane = new JScrollPane(selectTree);    scrollPane.getVerticalScrollBar().setPreferredSize(new Dimension(12, 0));    this.treePanel.add(scrollPane, BorderLayout.CENTER);  }  protected void doSearch() {    int rowCount = selectTree.getRowCount();    DefaultMutableTreeNode node = (DefaultMutableTreeNode) selectTree.getLastSelectedPathComponent();    if (node == null || node.getNextNode() == null)      node = (DefaultMutableTreeNode) selectTree.getModel().getRoot();    DefaultMutableTreeNode currentNode = node;    node = node.getNextNode();    if (node == null)      return;    // 从当前选中节点开始循环遍历整个树    while (node != currentNode) {      Company company = (Company) node.getUserObject();      String codeName = company.getCode() + company.getName();      if (codeName.indexOf(searchField.getText()) >= 0) {        for (int i = rowCount - 1; i > 0; i--) {          selectTree.collapseRow(i);        }        selectTree.setSelectionPath(new TreePath(node.getPath()));        ///        int[] selectedRows = selectTree.getSelectionRows();        if (selectedRows.length > 0) {          selectTree.scrollRowToVisible(selectedRows[0]);        }        return;      }      node = node.getNextNode();      // 遍历完毕没找到，从根目录开始循环找      if (node == null)        node = (DefaultMutableTreeNode) selectTree.getModel().getRoot();    }  }  public JTree getSelectTree() {    return selectTree;  }  public static void main(String[] args) {    CompanyTreePanel treepanle = new CompanyTreePanel();    JFrame f = new JFrame();    f.getContentPane().add(treepanle);    f.setSize(400, 300);    f.setLocationRelativeTo(null);    f.setVisible(true);    f.addWindowListener(new WindowAdapter() {      public void windowClosing(WindowEvent e) {        System.exit(0);      }    });  }}